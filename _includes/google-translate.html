<!-- Google Translate -->
<div id="google-translate"></div>

<script async
        type="text/javascript"
        src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit">
</script>

<script defer type="text/javascript">

    function googleTranslateElementInit() {
        new google.translate.TranslateElement(
            {
                pageLanguage: 'en',
                includedLanguages: 'en,fr,zh',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false
            },
            'google-translate'
        );
    }

    jQuery(document).ready(function () {

        let originalLanguage = "english";
        let originalLangHeader = $("#original-lang");
        let langs = $(".lang");

        function googleTranslate(language) {
            $('.goog-te-menu-frame').contents().find("a.goog-te-menu2-item").each(function () {
                if ($(this).text().toLowerCase().includes(language.toLowerCase())) {
                    $(this)[0].click();
                }
            });
        }

        function changeLanguage(language) {
            if (originalLanguage === language) {
                originalLangHeader.hide();
            } else {
                originalLangHeader.show();
            }
            langs.each(function () {
                if (language === $(this).data("lang")) {
                    $(this).find("span").addClass("focus");
                } else {
                    $(this).find("span").removeClass("focus");
                }
            });
            // Called twice
            googleTranslate(language);
            googleTranslate(language);
            window.localStorage.setItem('lang', language);
        }

        // init translation

        let currentLanguage = window.localStorage.getItem('lang');
        if (currentLanguage === null) {
            let browserLanguage = navigator.language.substring(0, 2);
            if (browserLanguage === "fr") {
                changeLanguage("chinese");
            } else {
                changeLanguage(originalLanguage);
            }
        } else {
            changeLanguage(currentLanguage);
        }

        // update translation

        langs.click(function () {
            let language = $(this).data("lang");
            changeLanguage(language);
        });

        // no translate

        setTimeout(function () {
            for (const jax of MathJax.Hub.getAllJax()) {
                jax.SourceElement().previousSibling.classList.add("notranslate");
            }
            $(".highlight").addClass("notranslate");
        }, 1000);

    });
</script>

<style type="text/css">
  body {
    top: 0 !important;
  }

  #lang {
    display: none !important;
  }

  .goog-te-banner-frame.skiptranslate {
    display: none !important;
  }

  .goog-tooltip {
    display: none !important;
  }

  .goog-tooltip:hover {
    display: none !important;
  }

  .goog-text-highlight {
    background-color: transparent !important;
    border: none !important;
    box-shadow: none !important;
  }

  .goog-te-gadget {
    display: none !important;
  }
</style>
